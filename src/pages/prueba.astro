---
const API_BASE = 'https://api-esqui-scraping-production.up.railway.app';
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="generator" content={Astro.generator} />
		<title>Prueba API - Sierra Nevada</title>
	</head>
	<body>
		<main>
			<div class="prueba-container">
				<h1>üß™ Prueba de API - Estaciones de Esqu√≠</h1>
				<p class="subtitle">Endpoints disponibles para las estaciones</p>
				
				<div class="endpoints-grid">
					<!-- Sierra Nevada -->
					<div class="endpoint-card">
						<h2>üèîÔ∏è Sierra Nevada</h2>
						<code class="endpoint-url">GET /estacion/sierra-nevada</code>
						<button onclick="testEndpoint('/estacion/sierra-nevada', 'result-sierra-nevada')">
							Probar Endpoint
						</button>
						<div id="result-sierra-nevada" class="result"></div>
					</div>

					<!-- Valdelinares -->
					<div class="endpoint-card">
						<h2>‚õ∞Ô∏è Valdelinares</h2>
						<code class="endpoint-url">GET /estacion/valdelinares</code>
						<button onclick="testEndpoint('/estacion/valdelinares', 'result-valdelinares')">
							Probar Endpoint
						</button>
						<div id="result-valdelinares" class="result"></div>
					</div>

					<!-- Candanch√∫ -->
					<div class="endpoint-card">
						<h2>üéø Candanch√∫</h2>
						<code class="endpoint-url">GET /estacion/candanchu</code>
						<button onclick="testEndpoint('/estacion/candanchu', 'result-candanchu')">
							Probar Endpoint
						</button>
						<div id="result-candanchu" class="result"></div>
					</div>

					<!-- Bo√≠ Ta√ºll -->
					<div class="endpoint-card">
						<h2>üèîÔ∏è Bo√≠ Ta√ºll</h2>
						<code class="endpoint-url">GET /estacion/boi-taull</code>
						<button onclick="testEndpoint('/estacion/boi-taull', 'result-boi-taull')">
							Probar Endpoint
						</button>
						<div id="result-boi-taull" class="result"></div>
					</div>
				</div>

				<!-- Endpoint General -->
				<div class="general-section">
					<h2>üìä Todas las Estaciones</h2>
					<div class="endpoint-card full-width">
						<code class="endpoint-url">GET /estaciones</code>
						<button onclick="testEndpoint('/estaciones', 'result-all')">
							Probar Endpoint
						</button>
						<div id="result-all" class="result"></div>
					</div>
				</div>

				<!-- Test All -->
				<div class="test-all-section">
					<button class="test-all-btn" onclick="testAllEndpoints()">
						üöÄ Probar Todas las Estaciones
					</button>
				</div>
			</div>
		</main>

		<div style="position: fixed; bottom: 24px; right: 24px; z-index: 999;">
			<div style="display: flex; align-items: center; gap: 8px; padding: 12px 18px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 50px; border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37), inset 0 1px 1px rgba(255, 255, 255, 0.5); font-size: 0.95rem; font-weight: 500; color: #333;">
				<span style="font-weight: 400; opacity: 0.9;">By</span>
				<span style="font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">PL8</span>
				<span style="font-size: 1.1rem;">‚ù§Ô∏è</span>
			</div>
		</div>

		<script is:inline define:vars={{ API_BASE }}>
			window.testEndpoint = async function(path, resultId) {
				const resultDiv = document.getElementById(resultId);
				const url = `${API_BASE}${path}`;
				
				resultDiv.innerHTML = '<div class="loading">‚è≥ Cargando...</div>';
				resultDiv.classList.add('show');
				
				try {
					const startTime = performance.now();
					const response = await fetch(url);
					const endTime = performance.now();
					const data = await response.json();
					
					const responseTime = (endTime - startTime).toFixed(2);
					
					if (response.ok) {
						resultDiv.innerHTML = `
							<div class="success">
								<div class="status">‚úÖ ${response.status} OK (${responseTime}ms)</div>
								<pre>${JSON.stringify(data, null, 2)}</pre>
							</div>
						`;
					} else {
						resultDiv.innerHTML = `
							<div class="error">
								<div class="status">‚ùå Error ${response.status}</div>
								<pre>${JSON.stringify(data, null, 2)}</pre>
							</div>
						`;
					}
				} catch (error) {
					resultDiv.innerHTML = `
						<div class="error">
							<div class="status">‚ùå Error de red</div>
							<pre>${error.message}</pre>
						</div>
					`;
				}
			}

			window.testAllEndpoints = async function() {
				const endpoints = [
					{ path: '/estacion/sierra-nevada', id: 'result-sierra-nevada' },
					{ path: '/estacion/valdelinares', id: 'result-valdelinares' },
					{ path: '/estacion/candanchu', id: 'result-candanchu' },
					{ path: '/estacion/boi-taull', id: 'result-boi-taull' }
				];

				for (const endpoint of endpoints) {
					await window.testEndpoint(endpoint.path, endpoint.id);
					await new Promise(resolve => setTimeout(resolve, 500));
				}
			}
		</script>
	</body>
</html>

<style is:global>
	body {
		margin: 0;
		padding: 0;
		font-family: system-ui, -apple-system, sans-serif;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		min-height: 100vh;
	}

	main {
		max-width: 1400px;
		margin: 0 auto;
		padding: 2rem;
	}

	.prueba-container {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	h1 {
		color: white;
		text-align: center;
		margin: 0 0 0.5rem 0;
		font-size: 2.5rem;
		text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
	}

	.subtitle {
		color: rgba(255, 255, 255, 0.9);
		text-align: center;
		margin: 0 0 2rem 0;
		font-size: 1.1rem;
	}

	.endpoints-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
		gap: 1.5rem;
		margin-bottom: 2rem;
	}

	.endpoint-card {
		background: white;
		border-radius: 16px;
		padding: 1.5rem;
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
		transition: transform 0.2s, box-shadow 0.2s;
	}

	.endpoint-card:hover {
		transform: translateY(-2px);
		box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
	}

	.endpoint-card h2 {
		color: #333;
		margin: 0 0 1rem 0;
		font-size: 1.3rem;
	}

	.endpoint-url {
		display: block;
		background: #f5f5f5;
		padding: 0.75rem 1rem;
		border-radius: 8px;
		font-family: 'Monaco', 'Courier New', monospace;
		font-size: 0.85rem;
		color: #667eea;
		margin-bottom: 1rem;
		word-break: break-all;
	}

	button {
		width: 100%;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
		border: none;
		padding: 0.875rem 1.5rem;
		border-radius: 8px;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.2s;
		box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
	}

	button:hover {
		transform: translateY(-1px);
		box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
	}

	button:active {
		transform: translateY(0);
	}

	.result {
		max-height: 0;
		overflow: hidden;
		transition: max-height 0.3s ease-out;
		margin-top: 0;
	}

	.result.show {
		max-height: 600px;
		margin-top: 1rem;
		overflow: auto;
	}

	.result pre {
		background: #1e1e1e;
		color: #d4d4d4;
		padding: 1rem;
		border-radius: 8px;
		overflow-x: auto;
		font-size: 0.85rem;
		line-height: 1.5;
		margin: 0.5rem 0 0 0;
	}

	.loading {
		text-align: center;
		padding: 1rem;
		color: #667eea;
		font-weight: 600;
	}

	.status {
		font-weight: 600;
		padding: 0.5rem;
		border-radius: 6px;
		margin-bottom: 0.5rem;
	}

	.success .status {
		background: #d4edda;
		color: #155724;
	}

	.error .status {
		background: #f8d7da;
		color: #721c24;
	}

	.general-section {
		margin: 2rem 0;
	}

	.general-section h2 {
		color: white;
		text-align: center;
		margin-bottom: 1rem;
		font-size: 1.5rem;
	}

	.full-width {
		max-width: 100%;
	}

	.test-all-section {
		display: flex;
		justify-content: center;
		margin-top: 1rem;
	}

	.test-all-btn {
		max-width: 400px;
		font-size: 1.1rem;
		padding: 1rem 2rem;
		background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
	}

	.test-all-btn:hover {
		box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
	}

	@media (max-width: 640px) {
		main {
			padding: 1rem;
		}

		h1 {
			font-size: 1.75rem;
		}

		.subtitle {
			font-size: 1rem;
		}

		.endpoints-grid {
			grid-template-columns: 1fr;
		}

		.endpoint-card {
			padding: 1rem;
		}

		.endpoint-url {
			font-size: 0.75rem;
		}
	}
</style>
